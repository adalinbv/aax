#
# spec file for package libaax2 (Version @PACKAGE_VERSION@)
#
# Copyright (c) 2011 Adalin B.V.
# This file and all modifications and additions to the pristine
# package are under the same license as the package itself.
#

Name:           libaax2
Version:        @AAX_VERSION@
Release:        2
Requires(pre):  dialog 
Summary:	Stereo and 4D Audio eXtensions library
Group:          System/Libraries
Provides:       libaax2
License:        License For Customer Use of ADALIN AEONWAVE AUDIO EXTENSIONS LIBRARY Software
Vendor:         Adalin B.V.
URL:            http://www.adalin.com/

%description
A hardware accelerated, high speed and versatile stereo and 4D audio mixing
library that can handle almost any audio mixing demands; from studio effect
mixing to immersive simulation. 
 
AeonWave combines the demands for stereo mixing as wel as immersive 3d audio
rendering or simulation and gaming in one library. There is support for
audio-frames that can either be used as containers for moving around multiple
3d sound emitters or for applying filters or effects to multiple stereo 
sources before sending it to the final mixer. There is also a three-band
parametric equalizer for the final mixing stage.
 
Stereo filters include Tremolo, Volume Envelope and Frequency filtering.
3D filters include angular and distance filtering.
Stereo effects include Vibrato, Pitch Envelope, Distortion and Chorus.
3D effects support consists of Velocity effect (Doppler).
 
A built-in waveform generator that supports Sine, Square, Triangle, Sawtooth
and Impulse waveforms as well as White, Pink and Brownian Noise. Different
waveforms can be mixed or ringmodulated at different frequencies and mixing
ratio's allowing a wide range of complex waveforms to be generated on-demand.
 
For audio buffers the library supports 9 native audio formats and a total
of 29 different formats (inclusing signed/unsigned and big/little-endian).
Buffers can be converted from and to any of the supported formats.


%prep
#%setup -q -n aax-%version 

%build

%install

%clean

%pre
if [ -z $DISPLAY ]; then DIALOG=dialog
else
  if [ -f /usr/bin/gdialog ]; then DIALOG=gdialog
  else if [ -f /usr/bin/xdialog ]; then DIALOG=xdialog
       else DIALOG=dialog
    fi
  fi
fi

tempfile=`tempfile 2>/dev/null` || tempfile=/tmp/test$$
trap "rm -f $tempfile" 0 1 2 5 15
$DIALOG --clear --title "License For Customer Use of ADALIN Software" \
        --cr-wrap --yesno "IMPORTANT NOTICE -- READ CAREFULLY: This License For Customer Use of ADALIN Software ("LICENSE") is the agreement which governs use of the software of ADALIN B.V. (“ADALIN”) obtainable herefrom, including computer software and associated printed materials ("SOFTWARE"). By obtaining, installing, copying, or otherwise using the SOFTWARE, you agree to be bound by the terms of this LICENSE. If you do not agree to the terms of this LICENSE, do not install the SOFTWARE.\n\nThe complete license is available online at:\n\nhttp://www.adalin.com/LICENSE-AeonWave.html\n\nBy accepting you agree to be bound by the terms and conditions laid out in the Customer License.\nDo you accept?" 45 70

case $? in
  0)
    USER="$SUDO_USER"
    if [ x"$USER" = x ]; then
      CONFIGFILE="$HOME/.aaxconfig.xml"
      USER=`stat -c %U $HOME`
      GROUP=`stat -c %G $HOME`
    else
      USER_HOME=`grep $USER /etc/passwd | cut -d ":" -f6`
      CONFIGFILE="$USER_HOME/.aaxconfig.xml"
      GROUP=`stat -c %G $USER_HOME`
    fi

    if [ x"$USER" = xroot ]; then
      if [ ! -d /etc/aax ] ;then
        mkdir /etc/aax;
      fi
      CONFIGFILE="/etc/aax/config.xml"
    fi

    if [ ! -f "$CONFIGFILE" ]; then

      $DIALOG --title "Personal product-key" --nocancel --clear --cr-wrap \
          --inputbox "The product-key is a series of letters and digits separated by dashes, and was\nprovided when you purchased the software. Without a proper product-key the\nsoftware will function in the Lite mode which is with limited functionality.\nKeep this line empty if you did not yet pruchase the product key.\n\nPlease enter the personal product-key:" 16 60 2> $tempfile
      retval=$?

      case $retval in
        0)
          KEY=`cat $tempfile`
          echo -e "<?xml version="1.0"?>\n\n<Configuration>\n<product-key>$KEY</product-key>\n <output>\n  <frequency-hz>48000</frequency-hz>\n  <interval-hz>46</interval-hz>\n  <update-hz>20</update-hz>\n  <setup>stereo</setup>\n </output>\n</Configuration>" > $CONFIGFILE
          chmod 600 $CONFIGFILE
          chown $USER:$GROUP $CONFIGFILE
          ;;
      esac
      rm -f $tempfile
    fi
    ;;
  1)
    exit 1;;
  255)
    exit 1;;
esac


%post
ldconfig


%postun
USER=$SUDO_USER
if [ x$USER = "x" ]; then
  CONFIGFILE="$HOME/.aaxconfig.xml"
  USER=`stat -c %U $HOME`
  GROUP=`stat -c %G $HOME`
else
  USER_HOME=`grep $USER /etc/passwd | cut -d ":" -f6`
  CONFIGFILE="$USER_HOME/.aaxconfig.xml"
  GROUP=`stat -c %G $USER_HOME`
fi

# remove stale configuration files
if [ $USER = "root" ]; then
  if [ -d /etc/aax ] ;then
    rm -f /etc/aax/config.xml > /dev/null;
    rmdir /etc/aax > /dev/null;
  fi
fi
rm -f $CONFIGFILE;
ldconfig


%files
%defattr(-,root,root)

%dir %{_defaultdocdir}/%{name}/
%doc %{_defaultdocdir}/%{name}/copyright
%doc %{_defaultdocdir}/%{name}/changelog.gz
%doc %{_defaultdocdir}/%{name}/examples/*

%{_bindir}/aaxinfo
%{_libdir}/libaax.so*
%{_includedir}/aax*.h

%changelog -n aax
* Fri Nov 11 2011 - tech@adalin.org
- Fix a possible deadlock situation
* Mon Oct 10 2011 - tech@adalin.org
- Added waveform generator
- Added timed-gain filter and timed-pitch effect (envelopes)
- Assorted small bug-fixes and usability updates.
* Tue Aug 27 2011 - tech@adalin.org
- Added hardware acceleration
- Added submixing capable audio-frames
- Added support for Filters and Effects
- New simplified, robust and consistent API
- New spatialised speaker setup
* Wed Dec 23 2009 - tech@adalin.org 
- Split up the AeonWave library and the OpenAL support code
- New HRTF and Surround sound
- Added matrix operations
* Wed May 21 2008 - tech@adalin.org 
- created package
